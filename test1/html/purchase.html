<!DOCTYPE html>
<html lang="en-us">

<head>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="/static/css/bootstrap.3.3.7.min.css">

  <!-- jQuery library -->
  <script src="/static/scripts/jquery.3.2.1.min.js"></script>
  <!-- Latest compiled JavaScript -->
  <script src="/static/scripts/bootstrap.3.3.7.min.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>美基金朋友圈交易站</title>
</head>

<body>
  <div class="container">
    <nav class="navbar navbar-inverse">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#" ><img src="/static/img/axfund_icon.png" width=96 height=36></a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav">
            <li><a href="#">卖美基金</a></li>
            <li><a href="#">买美基金</a></li>
            <li><a href="#">我的交易</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="account.html"><span class="glyphicon glyphicon-user"></span>我的账户</a></li>
            <li><a href="logout.html"><span class="glyphicon glyphicon-log-in"></span>退出</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </div>
  {% load mathfilters %}
  <div class="container">
    <h6>美基金余额：2302.35 状态：锁定</h6>
    <div class="well">
      <script language="JavaScript">
      function create_purchase_order(sell_order_id, sell_order_owner_userid,
          owner_login,
         locked_in_unit_price, available_units_for_purchase) {
           alert("unit price is " + locked_in_unit_price);
          $("#reference_order_id").val(sell_order_id);
          $("#owner_user_id").val(sell_order_owner_userid);
          $("#owner_login").val(owner_login);
          $("#locked_in_unit_price").val(locked_in_unit_price);
          $("#available_units_for_purchase").val(available_units_for_purchase);

          $("#form_create_purchase_order").submit();
      }
      </script>
      <form id="form_create_purchase_order" action="/purchase/createorder1/" method="post">
        {% csrf_token %}
        <input type="hidden" name="username" value="{{ username }}"/>
        <input type="hidden" id="reference_order_id" name="reference_order_id" value=""/>
        <input type="hidden" id="owner_user_id" name="owner_user_id" value=""/>
        <input type="hidden" id="owner_login" name="owner_login" value=""/>
        <input type="hidden" id="locked_in_unit_price" name="locked_in_unit_price" value=""/>
        <input type="hidden" id="available_units_for_purchase" name="available_units_for_purchase" value=""/>
      </form>
      <div class="row">
        <h3>卖单状况</h3>
        <table class="table table-striped table-condensed">
          <tr>
            <th>原始出售总数</th>
            <th>余额</th>
            <th></th>
          </tr>
          {% if sellorders %}
             {% for order in sellorders %}
          <tr>
            <td>{{ order.total_units }}美基金单价{{ order.unit_price }}CNY，总额{{ order.total_units|mul:order.unit_price }}CNY</td>
            <td>还有{{ order.available_units }}可以购买</td>
            {% if order.status == 'LOCKED' %}
            <td>被锁定</td>
            {% else %}
            <td><button type="button" class="btn btn-primary" onclick="create_purchase_order('{{ order.order_id }}', '{{ order.owner_user_id }}', '{{ order.owner_login }}','{{ order.unit_price }}', '{{ order.available_units }}')">购买</button></td>
            {% endif %}
          </tr>
             {% endfor %}
          {% else %}
          <tr>
            <td>目前暂时没有卖单</td>
            <td>
          </tr>
          {% endif %}
        </table>
      </div>
    </div>
    <!-- popup window for confirm payment of purchase -->
    <form id="buy-modal" tabindex="-1" class="modal fade" role="dialog" action="/mysellorder/confirm_payment/" aria-labelledby="lockfund-form-label" aria-hidden="true" method='post'>
      {% csrf_token %}
      <input type="hidden" id="id_username" name="username" value = "{{ username }}"/>
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 id="lockfund-form-label">确认付款</h4>
          </div>
          <div class="modal-body">
            <div id="div_purchase_content" class="form-group">
              <table class="table">
                <tr>
                  <td><label class="control-label">数量</label></td>
                  <td><label class="control-label" id="id_units_confirm">&nbsp;</label>
                </tr>
                <tr>
                  <td><label class="control-label">单价</label></td>
                  <td><label class="control-label" id="id_units_price_confirm">&nbsp;</label>
                </tr>
                <tr>
                  <td><label class="control-label">总额</label></td>
                  <td><label class="control-label" id="id_total_amount_confirm">&nbsp;</label>
                </tr>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-default" data-dismiss="submit">确认</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">撤销</button>
          </div>
        </div>
    </form>
    <!-- popup window for purchase -->
    <form id="buy-modal" tabindex="-1" class="modal fade" role="dialog" action="/mysellorder/" aria-labelledby="lockfund-form-label" aria-hidden="true" method='post'>
      {% csrf_token %}
      <input type="hidden" id="id_action" name="action" value="create_order" />
      <input type="hidden" id="id_username" name="username" value = "{{ username }}"/>
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 id="lockfund-form-label">出售美基金</h4>
          </div>
          <div class="modal-body">
            <div id="div_id_quantity" class="form-group">
              <label for="id_username" class="control-label">数量</label><span class="asteriskField">*</span> </label>
              <div class="controls "> <input class="textinput textInput form-control" id="id_quantity" maxlength="10" name="quantity" type="text" /> </div>
            </div>
            <div id="div_id_quantity" class="form-group">
              <label for="id_username" class="control-label">单价</label><span class="asteriskField">*</span> </label>
              <div class="controls "> <input class="textinput textInput form-control" id="id_unitprice" maxlength="10" name="unitprice" type="text" /> </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-default" data-dismiss="submit">锁定</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">撤销</button>
          </div>
        </div>
    </form>

  </div>

  </div>
  <footer class="container">
    <div class="row" style="text-align: center;">
      美基金团队版权所有2017&copy
    </div>
  </footer>
</body>
<script>
</script>
</html>
